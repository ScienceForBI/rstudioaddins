---
output:
  html_document:
    highlight: textmate
    includes:
      after_body: includes/after.html
      before_body: includes/before.html
      in_header: includes/header.html
    self_contained: no
    theme: cosmo
---

## Overview

<div class="doc-header">RStudio Addins</div>

Addins provide a mechanism for executing R functions interactively from within the RStudio IDE---either through keyboard shortcuts, or through the `Addins` menu. Addins can be as simple as a function that inserts a commonly used snippet of text, and as complex as a Shiny application that accepts input from the user, and later mutates a document open in RStudio.

The sky is limit for addins! For example:

- Interactively subset a dataset
[![Subset Demo](demo/demo-subset.png)](demo/demo-subset.gif)

- Interactively reformat R code
[![Reformat Demo](demo/demo-reformat.png)](demo/demo-reformat.gif)

This guide walks you through the basics of installing addins, binding keyboard shorcuts to them, and finally developing your own addins.

## Using Addins

### Installation

RStudio Addins are distributed and installed from within standard R packages. Once you've installed an R package that contains addins they'll be immediately available within the IDE.

Let's start by playing around with a couple of the example addins provided by the [addinexamples](https://github.com/rstudio/addinexamples) package. Within RStudio, install this package (plus its requisite dependencies) with:

```{r, eval=FALSE}
if (!requireNamespace("devtools", quietly = TRUE))
  install.packages("devtools")

devtools::install_github("rstudio/shiny")
devtools::install_github("rstudio/shinygadgets")
devtools::install_github("rstudio/addinexamples")
```

Note that for the time being the **addinexamples** package requires development versions of two other packages so be sure to install those as well!

### Executing Addins

After installing this package, you should see the `Addins` toolbar menu populated with the addins exported by this package:

![Addins Menu](images/addins-menu.png)

Try clicking the **Insert %in%** addin -- you'll see the text ` %in% ` inserted at the cursor position.

This is a simple addin, but we can also build interactive Shiny applications to be launched as addins. For example, datasets can be subsetted interactively using the **Subsetter** addin -- click the following image for a quick demo.

### Keyboard Shorcuts

Of course, it would be preferable to insert ` %in% ` through a keyboard shortcut rather than through clicking through a menu, so let's bind this addin to a keyboard shortcut.

First, click `Browse Addins...` to explore all of the addins currently available:

![Browse Addins](images/addins-dialog.png)

At the bottom left of the dialog, you'll see the `Keyboard Shortcuts...` button. Click this, and the `Modify Keyboard Shortcuts` widget will be opened, filtered to the current set of addins. Let's bind `Insert In` to `Ctrl+Alt+Shift+K` -- click on the 'Shortcut' field for the 'Insert In' addin row, and type those keys.

![Keyboard Shortcuts](images/addins-shortcuts.png)

You've now bound this addin to a keyboard shortcut! Try typing `Ctrl+Alt+Shift+K` in the editor, and you'll see ` %in% ` inserted at the cursor position. You can imagine generating a number of these addins yourself for other commonly used code snippets or operators.

## Developing Addins

### Addin Basics

You might be surprised to know that `insert_in` is implemented entirely with R code. In fact, the R function that made this happen is located [here](https://github.com/rstudio/addinexamples/blob/master/R/insert-in.R), and its definition is simply:

```{r, eval=FALSE}
insert_in <- function() {
  rstudioapi::insertText(" %in% ")
}
```

If you want to try something silly, try executing `addinexamples::insert_in()` directly at the console. You should also see ` %in% ` inserted immediately after executing the function. This is exactly what RStudio is doing behind the scenes; it's just allowing you to execute that function through some UI rather than manually writing and executing the function yourself.

There are two major types of addins:

1. Text Macros, which insert text into the console or source pane and in some cases transform text witin the source pane.

2. Shiny Gadgets, which are fully interactive Shiny applications. Gadgets may also do text transformations but they of course capable of much more.

More details on both types of addin are provided below, but first we'll take a look at using the [rstudioapi](https://cran.rstudio.com/web/packages/rstudioapi/index.html) package to interact with the IDE as well the requirements for registering addins.

### RStudio API

TODO: describe general capabiliites and philosophy of the API

| Function  | Description |
|---|---|
| `getActiveDocumentContext()` | Returns information about the currently active RStudio document (see below for details) |
| `insertText(location, text, id = NULL)` | Insert text at specific location within a document. |
| `modifyRange(location, text, id = NULL)` | Modify (replace) the contents of a specific location within document. |
| `setDocumentContents(text, id = NULL)` | Replace the entire contents of a document. |

The list returned from `getActiveDocumentContext()` provides the following information about the active RStudio document:

- *id* --- The unique document id.
- *path* --- The path to the document on disk.
- *contents* --- The contents of the document.
- *selection* --- A list of selections. 

The `id` can be passed to other functions within the API to address a specific document instance rather than the currently active document. Even though it's optional it's highly recommended that you use the `id` parameter to ensure that you modify the document that was active when your addin was invoked.

The `location` argument to several of the API functions specifies a position or range to operate on. See the [rstudioapi manual](https://cran.r-project.org/web/packages/rstudioapi/rstudioapi.pdf) for more details on specifying locations.


### Registering Addins

Since addins are just R functions, how does `addinexamples` let RStudio know what functions are safe to call as addins? This is done through the registration file located at [inst/rstudio/addins.dcf](https://github.com/rstudio/addinexamples/blob/master/inst/rstudio/addins.dcf). Each addin you register should have the following four fields:

- **Name**: The name of the addin.
- **Description**: A description of the addin.
- **Binding**: The R function this addin is associated with.
- **Interactive**: Whether this addin is interactive (e.g. as a Shiny application).

For example:

```dcf
Name: Insert %in%
Description: Inserts `%in%` at the cursor position.
Binding: insert_in
Interactive: false
```

If you want to create your own RStudio addins, all you need to do is:

1. Create an R package,
2. Create some R functions, and
3. Create a file at `inst/rstudio/addins.dcf`,

RStudio will automatically discover and register these addins when your package is installed.

### Text Macros

Describe the basic use case for non-interactive addins (text insertion or transformation), emphasize the requirement of registering them with Interactive: false and describe the implications of this (nothing emitted to the console, executed in the background, can *never* hang, etc.)

Perhaps show or link to the source code for a couple of other examples.


### Shiny Gadgets

Here we'd have a whole top level section on developing addins with shiny gadgets. We'd want to cover:

- Requirement for "Interactive: true"
- Basic concept of a shiny gadget + a simple example + links to shiny gadget docs
- Describe the different viewing options (pane, dialog, external) and their pros and cons.
- Links to source code for shiny gadgets in our addinexamples package

This should serve as a very simple introduction to shiny gadgets such that folks can see the concept and it's application but should defer to the shinygadgets docs for more in depth topics.

Perhaps show a single example and then link to the source code of other examples.

<div class="doc-footer">

Questions? Comments? Suggestions? Please get in touch with us at the [support forums](http://support.rstudio.com/)

</div>
